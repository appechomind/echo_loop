Improve error handling and detect UI loops